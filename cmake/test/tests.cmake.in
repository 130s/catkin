# set directory for test results
if(ENV{CATKIN_TEST_RESULTS_DIR})
  message("Override test results directory with environment variable CATKIN_TEST_RESULTS_DIR=${CATKIN_TEST_RESULTS_DIR}")
  set(CATKIN_TEST_RESULTS_DIR $ENV{CATKIN_TEST_RESULTS_DIR} CACHE INTERNAL "")
else()
  set(CATKIN_TEST_RESULTS_DIR ${CMAKE_BINARY_DIR}/test_results CACHE INTERNAL "")
endif()

# create target to build tests
if(NOT TARGET tests)
  add_custom_target(tests)
  message("TODO: implement add_roslaunch_check() in rostest-extras.cmake")
endif()

# create target to run tests
if(NOT TARGET test)
  add_custom_target(test)
  add_dependencies(test tests)
endif()

# create target to clean test results
if(NOT TARGET clean-test-results)
  # clean out previous test results before running tests
  add_custom_target(clean-test-results
    COMMAND ${CMAKE_COMMAND} -E remove_directory ${CATKIN_TEST_RESULTS_DIR})
  # make the 'tests' target depend on 'clean-test-results'
  # which will ensure that test results are deleted before we try to build tests
  # and thus before we try to run tests
  add_dependencies(tests clean-test-results)
endif()

if(@BUILDSPACE@)
  find_program_required(CHECK_TEST_RAN_EXE check_test_ran.py
    PATHS @catkin_EXTRAS_DIR@
    NO_DEFAULT_PATH)
else()
  find_program_required(CHECK_TEST_RAN_EXE check_test_ran.py
    PATHS @CMAKE_INSTALL_PREFIX@/share/catkin/cmake
    NO_DEFAULT_PATH)
endif()
